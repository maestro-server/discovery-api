FROM maestroserver/maestro-python-gcc

COPY docker-entrypoint.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/docker-entrypoint.sh

ENV APP_PATH=/opt/application

WORKDIR $APP_PATH

COPY ./app $APP_PATH/app
COPY ./instance $APP_PATH/instance
COPY requirements.txt requirements.txt
COPY package.json package.json
COPY run.py $APP_PATH/run.py

RUN pip3 install -r requirements.txt

USER app
ENTRYPOINT ["/sbin/tini","-g","--"]
CMD ["docker-entrypoint-workers.git sh"]